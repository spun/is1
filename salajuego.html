{% extends "templates/pattern.html" %}

{% block title %}Salas{% endblock %}

{% block head %}


	<style>
	
		#chatZone-history {
			border: 1px solid silver;
			border-radius: 3px;
			height: 476px;
			margin-bottom: 5px;
		}

		#chatZone-history ul {
			list-style: none;
			font-size: 0.9em;
			overflow: auto;
			height: 466px;
			width: 145px;
			padding: 10px 0;
			
		}

		#chatZone-history li {
			margin: 5px 0;
			color: #333333;
		}

		#chatZone-history li span {
			font-weight: bold;
			color: black;
		}

		#chatZone-history ul::-webkit-scrollbar {
			width: 6px;
		}
		/* Track */
		#chatZone-history ul::-webkit-scrollbar-track {
			-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
			-webkit-border-radius: 10px;
			border-radius: 10px;
		}

		/* Handle */
		#chatZone-history ul::-webkit-scrollbar-thumb {
			-webkit-border-radius: 10px;
			border-radius: 10px;
			background: #EBEBEB;
			-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5);
		}

		#chatZone-history ul::-webkit-scrollbar-thumb:hover {
			background: #F5F5F5;
		}
		
		#chatZone-form #appendedPrependedInput {
			width: 128px;
		}
        
        
		#playerContainer {
			border-top: 1px solid silver;
            border-bottom: 1px solid silver;
			height: auto;
            margin: 0px 0px 2px 0px;
		}
        
        #playerContainer:hover{
			border-top: 1px solid silver;
            border-bottom: 1px solid silver;
			height: auto;
            margin: 0px 0px 2px 0px;
            background-color: #E0ECF8;
		}
	</style>
{% endblock %}

{% block script %}

	<script type="text/javascript" src='/_ah/channel/jsapi'></script>
	<script type="text/javascript">
		var state = {
			token: '{{ token }}',
			game_key: '{{ game_key }}',
			user_key: '{{ user.key }}'
		};		
	</script>
	<script type="text/javascript" src='js/broadcast.js'></script>
	<script type="text/javascript" src='js/chat.js'></script>
	<script type="text/javascript">
		
		Broadcast.init({
			state: state,	// Declarado en juego.html
			onopen: function() {
				console.log('# Socket open');
			},
			onmessage: function(m) {
				dat = JSON.parse(m.data);
				ChatZone.receiveMessage(dat.content);		
			}				
		});

		ChatZone.init({
			history: $('#chatZone-history'),
			form: $('#chatZone-form'),
			urlChat: 'http://'+location.host+'/salabroadcast/chat',
			sender: Broadcast.sendMessage
		});		
		
		$("#inputUrl").val(location.href);
			
		
	</script>

{% endblock %}


{% block content %}

    <div id="salaJuegoContent">
        <div id="salaJuegoUsers">
            {% for user in user_list %}
                <div id="playerContainer">
                    
                    <div id="playerAvatar"><img src="/img/Salas/triforce.jpg" alt="Anterior" /></div>
                    <div id="playerDatos">
                        <a href="/perfil?user={{user.nick}}" title="Ir al perfil de {{user.nick}}">{{user.nick}}</a>
                        <p><b>Ptos:</b> -----</p>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <div id="salaJuegoChat">
    
        </div>
    
        <div id="salaJuegoChatIn"></div>
        <div id="salaPlay"><p><a href="/juego?gamekey={{gamekey}}">PLAY!</a></p><p><a href="/salajuego?e=1">Salir</a></p></div>
    </div>
{% endblock %}

{% block container %}
	<div class="row">
		<div class="span9">
			{% for user in user_list %}
                <div id="playerContainer">
                    <div class="row">
                        <div class="span1">
                            {% if user.avatar %}
                            <img id="avatar" src="/imgs/user?img_id={{user.key}}" width="22" height="22" alt="Imagen de usuario"/> 
                            {% else %}
                            <img id="avatar" src="/img/layout/default-user.jpg" width="28" height="28" alt="Imagen de usuario"/> 
                            {% endif %}
                        </div>
                        <div class="span2">
                            <a href="/perfil?user={{user.nick}}" title="Ir al perfil de {{user.nick}}"><h3>{{user.nick}}</h3></a>
                        </div>
                        <div class="span6">
                            <div class="btn-group pull-right">
                            <a class="btn dropdown-toggle" data-toggle="dropdown" href="#"><span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                  <li><a href="/perfil?user={{user.nick}}&amistad=0"><i class="icon-heart"></i> Amistad</a></li>
                                  <li><a href="#"><i class="icon-envelope"></i> Mens. Privado</a></li>
                                </ul>
                            </div>                          
                        </div>
                    </div>
                </div>
            {% endfor %}
		</div>
		<div class="span3">
			<div id="chatZone-history">
				<ul>				
				</ul>
			</div>
			<form class="form-horizontal" id="chatZone-form">
				<fieldset>
					 <input type="text" class="span3" placeholder="Mensaje">
				</fieldset>
			</form>		
		</div>
	</div>
	
	<div class="row">
		<div class="span9">
			<form class="form-inline">
				<div class="control-group pull-ledt">
					<div class="controls">
						<div class="input-prepend">
							<span class="add-on"><i class="icon-gift"></i> Invita a un jugador</span><input class="span7" id="inputUrl" type="text" disabled="disabled">
						</div>
					</div>
				</div>
			</form>
		</div>
		<div class="span3">
            <form class="well">
                <div class="span3">
                    <a class="btn btn-success" href="/juego?gamekey={{gamekey}}"><i class="icon-play icon-white"></i> Jugar!</a>
                    <a class="btn btn-danger" href="/salajuego?e=1"><i class="icon-remove icon-white"></i> Salir</a>
                </div>
            </form>
		</div>
	</div>

{% endblock %}
