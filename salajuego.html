{% extends "templates/pattern.html" %}

{% block title %}Salas{% endblock %}

{% block script %}
	<script type="text/javascript" src='/_ah/channel/jsapi'></script>
	<script type="text/javascript">
		var state = {
			token: '{{ token }}',
			game_key: '{{ game_key }}',
			user_key: '{{ user.key }}'
		};		
	</script>
	<script type="text/javascript" src='js/broadcast.js'></script>
	<script type="text/javascript" src='js/chat.js'></script>
	<script type="text/javascript">
		
		Broadcast.init({
			state: state,	// Declarado en juego.html
			onopen: function() {
				console.log('# Socket open');
			},
			onmessage: function(m) {
				dat = JSON.parse(m.data);
				console.log(dat);
				ChatZone.receiveMessage(dat.content);		
			}				
		});

		ChatZone.init({
			history: $('#chatZone-history'),
			form: $('#chatZone-form'),
			urlChat: 'http://'+location.host+'/salaBroadcast/chat',
			sender: Broadcast.sendMessage
		});		
	</script>

{% endblock %}


{% block content %}

    <div id="salaJuegoContent">
        <div id="salaJuegoUsers">
            {% for user in user_list %}
                <div id="playerContainer">
                    <div id="playerAvatar"><img src="/img/Salas/triforce.jpg" alt="Anterior" /></div>
                    <div id="playerDatos">
                        <a href="/perfil?user={{user.nick}}" title="Ir al perfil de {{user.nick}}">{{user.nick}}</a>
                        <p><b>Ptos:</b> -----</p>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <div id="salaJuegoChat">
    
        </div>
    
        <div id="salaJuegoChatIn"></div>
        <div id="salaPlay"><p><a href="/juego?gamekey={{gamekey}}">PLAY!</a></p><p><a href="/salajuego?e=1">Salir</a></p></div>
    </div>
{% endblock %}

{% block container %}
	<div class="row">
		<div class="span9">
                    <form class="well">
                        <p>Blabla</p>
                        <p>Blabla</p>
                        <p>Blabla</p>
                        <p>Blabla</p>
                        <p>Blabla</p>
                        <p>Blabla</p>
                        <p>Blabla</p>
                        <p>Blabla</p>
                        <p>Blabla</p>
                        <p>Blabla</p>
                        <p>Blabla</p>
                    </form>
		</div>
		<div class="span3">  
                    <div id="chatZone-history">
                        <form class="well">
                            {% for user in user_list %}
                                <p><a href="/perfil?user={{user.nick}}" title="Ir al perfil de {{user.nick}}">{{user.nick}}</a></p>
                            {% endfor %}
                        </form>
                    </div>
		</div>
	</div>
	
	<div class="row">
		<div class="span9">
                    <form class="well form-horizontal" id="chatZone-form">
                        <fieldset>
                            <div class="input-append">
                                <input class="span" id="appendedPrependedInput" style="width: 120px" size="6" type="text"><button class="btn" type="button">></button>
                            </div>
                        </fieldset>
                    </form>
		</div>
		<div class="span3">
                    <form class="well">
                        <div class="span3">
                            <p><a class="btn btn-success" href="/juego?gamekey={{gamekey}}"><i class="icon-play icon-white"></i> Jugar!</a>
                            <a class="btn btn-danger" href="/salajuego?e=1"><i class="icon-remove icon-white"></i> Salir</a></p>
                        </div>
                    </form>
		</div>
	</div>

{% endblock %}
